import argparse
from pathlib import Path
import json

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument('--results', type=str, required=True, help='Path to results generated by process_results.py')
    args = parser.parse_args()

    with open(Path(args.results)/'complete.json', 'r') as f:
        results = json.load(f)
    
    for mode, sub_res in results.items():
        ng_imp = 0
        ap_imp = 0
        ng_it = 0
        ap_it = 0
        for id, res in sub_res.items():
            if id == 0:
                continue
            ngram = [float(x[0]) for x in res]
            api = [float(x[1]) for x in res]
            ng_count = 0
            ap_count = 0
            for i in range(1, len(res)):
                if ngram[i] > ngram[i-1]:
                    ng_count += 1
                if api[i] > api[i-1]:
                    ap_count += 1
            if ng_count > 0:
                ng_imp += 1
            if ap_count > 0:
                ap_imp += 1
            if ng_count > 1:
                ng_it += 1
            if ap_count > 1:
                ap_it += 1
        print(f'For mode {mode}:')
        print(f'N-gram improvement: {ng_imp}')
        print(f'API improvement: {ap_imp}')
        print(f'N-gram improvement (iterative): {ng_it}')
        print(f'API improvement (iterative): {ap_it}')
